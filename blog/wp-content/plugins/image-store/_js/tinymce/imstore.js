(function(){tinymce.create("tinymce.plugins.imStore",{init:function(a,b){t=this;t.url=b;t._createButtons();a.addCommand("imStoreOpen",function(){a.windowManager.open({inline:1,width:500,height:295,file:b+"/tinymce.php?nonce=347234"},{plugin_url:b})});a.addCommand("imsEditImage",function(){var c=a.selection.getNode(),d,e,f,g=a.dom.getAttrib(c,"class");if(g.indexOf("imsGallery")!=0||c.nodeName!="IMG")return;q=a.dom.getAttrib(c,"title").replace(/\s/g,"&");a.windowManager.open({inline:1,width:500,height:295,file:b+"/tinymce.php?nonce=347234&"+q},{plugin_url:b})});a.addButton("imstore",{cmd:"imStoreOpen",image:b+"/imstore.png"});a.onBeforeSetContent.add(function(a,b){b.content=t._do_gallery(b.content,t.url)});a.onPostProcess.add(function(a,b){if(b.get)b.content=t._get_gallery(b.content)});a.onMouseDown.add(function(a,b){var c=b.target;if(a.dom.getAttrib(c,"class").indexOf("imsGallery")==0){t._showButtons(c,"ims_editbtns")}else{t._hideButtons()}});a.onInit.add(function(a){tinymce.dom.Event.add(a.getWin(),"scroll",function(a){t._hideButtons()});tinymce.dom.Event.add(a.getBody(),"dragstart",function(a){t._hideButtons()})})},_do_gallery:function(a,b){return a.replace(/\[ims-gallery([^\]]*)\]/g,function(a,c){return'<img src="'+b+'/i.gif" class="imsGallery mceItem"  title="ims-gallery'+tinymce.DOM.encode(c)+'" />'})},_getAttr:function(a,b){b=(new RegExp(b+'="([^"]+)"',"g")).exec(a);return b?tinymce.DOM.decode(b[1]):""},_get_gallery:function(a){return a.replace(/(?:<p[^>]*>)*(<img[^>]+>)(?:<\/p>)*/g,function(a,b){var c=t._getAttr(b,"class");t._hideButtons();if(c.indexOf("imsGallery")!=-1)return"<p>["+tinymce.trim(t._getAttr(b,"title"))+"]</p>";return a})},_createButtons:function(){var a=this,b=tinyMCE.activeEditor,c=tinymce.DOM,d,e;c.remove("ims_editbtns");c.add(document.body,"div",{id:"ims_editbtns",style:"display:none;"});d=c.add("ims_editbtns","img",{src:a.url+"/image.png",id:"ims_editibtn",width:"24",height:"24"});tinymce.dom.Event.add(d,"mousedown",function(a){var b=tinyMCE.activeEditor;b.windowManager.bookmark=b.selection.getBookmark("simple");b.execCommand("imsEditImage")});e=c.add("ims_editbtns","img",{src:a.url+"/delete.png",id:"ims_deletebtn",width:"24",height:"24"});tinymce.dom.Event.add(e,"mousedown",function(a){var b=tinyMCE.activeEditor,c=b.selection.getNode(),d;if(c.nodeName=="IMG"&&b.dom.getAttrib(c,"class").indexOf("imsGallery")==0){if((d=b.dom.getParent(c,"div"))&&b.dom.hasClass(d,"mceTemp"))b.dom.remove(d);else if((d=b.dom.getParent(c,"A"))&&d.childNodes.length==1)b.dom.remove(d);else b.dom.remove(c);b.execCommand("mceRepaint");return false}})},_hideButtons:function(){if(document.getElementById("ims_editbtns"))tinymce.DOM.hide("ims_editbtns")},_showButtons:function(a,b){var c=tinyMCE.activeEditor,d,e,f,g=tinymce.DOM,h,i;f=c.dom.getViewPort(c.getWin());d=g.getPos(c.getContentAreaContainer());e=c.dom.getPos(a);h=Math.max(e.x-f.x,0)+d.x;i=Math.max(e.y-f.y,0)+d.y;g.setStyles(b,{top:i+5+"px",left:h+5+"px",display:"block"})}});tinymce.PluginManager.add("imstore",tinymce.plugins.imStore)})();jQuery(window).ready(function(a){wh=324;fh=295;resize_gal_window=function(b){wt=a(".clearlooks2").position().top-b/2;a(".clearlooks2").css({height:wh+b+"px",top:wt+"px"});a(".clearlooks2 iframe").css({height:fh+b+"px"});wh=wh+b;fh=fh+b}})